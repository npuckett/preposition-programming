<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>P5.js Preposition Examples</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Mobile-specific enhancements for index11 */
        @media (max-width: 768px) {
            .index-container {
                position: relative;
                height: 100vh;
                overflow: hidden;
            }
            
            .sidebar {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 280px !important;
                height: 100vh !important;
                transform: translateX(-100%) !important;
                transition: transform 0.3s ease-in-out !important;
                z-index: 1000 !important;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1) !important;
                background: white !important;
                overflow-y: auto !important;
                border-right: none !important;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0) !important;
            }
            
            /* Completely override any collapsed or hidden states */
            .sidebar .menu-group,
            .sidebar.collapsed .menu-group {
                display: block !important;
                margin-bottom: 15px !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: auto !important;
                overflow: visible !important;
            }
            
            .sidebar .menu-item,
            .sidebar.collapsed .menu-item {
                display: block !important;
                width: 100% !important;
                text-align: left !important;
                padding: 12px 20px 12px 35px !important;
                border: none !important;
                background: none !important;
                cursor: pointer !important;
                font-size: 14px !important;
                color: #333 !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: auto !important;
                line-height: normal !important;
                margin: 0 !important;
            }
            
            .sidebar .menu-item:hover {
                background: #f5f5f5 !important;
                color: #4CAF50 !important;
            }
            
            .sidebar .header {
                display: block !important;
                padding: 20px !important;
                background: #4CAF50 !important;
                color: white !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .sidebar .group-title {
                display: block !important;
                padding: 15px 20px 10px 20px !important;
                font-size: 14px !important;
                font-weight: bold !important;
                color: #666 !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: auto !important;
            }
            
            .mobile-toggle {
                position: fixed !important;
                top: 15px !important;
                left: 15px !important;
                z-index: 1001 !important;
                background: #4CAF50 !important;
                color: white !important;
                border: none !important;
                padding: 10px !important;
                border-radius: 4px !important;
                font-size: 16px !important;
                cursor: pointer !important;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2) !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .content {
                width: 100%;
                height: 100vh;
                padding-top: 0;
            }
            
            .content-header {
                padding-left: 60px; /* Make room for mobile toggle */
            }
            
            .frame-container {
                height: calc(100vh - 60px);
                overflow: hidden;
            }
            
            /* Ensure iframe content is touchable and scrollable */
            iframe {
                width: 100%;
                height: 100%;
                border: none;
                touch-action: auto;
                -webkit-overflow-scrolling: touch;
                overflow: auto;
            }
            
            /* Backdrop when sidebar is open */
            .mobile-backdrop {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 999;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease-in-out;
            }
            
            .mobile-backdrop.active {
                opacity: 1;
                visibility: visible;
            }
        }
        
        /* Enhance iframe for better mobile touch support */
        iframe {
            pointer-events: auto;
            touch-action: manipulation;
        }
        
        /* Prevent zooming on mobile when interacting with iframe */
        .frame-container {
            touch-action: pan-y;
        }
    </style>
</head>
<body class="index-body">
    <div class="index-container">
        <!-- Mobile backdrop -->
        <div class="mobile-backdrop" id="mobile-backdrop"></div>
        
        <!-- Mobile toggle button (always visible on mobile) -->
        <button class="mobile-toggle" id="mobile-toggle">☰</button>
        
        <div class="sidebar" id="sidebar">
            <div class="header">
                <h1>P5.js Prepositions</h1>
                <p>Methods for converting language to code</p>
            </div>

            <div class="menu-group">
                <div class="group-title">Spatial Relationships</div>
                <button class="menu-item" onclick="loadExample('preposition-above.html', 'Above', this)">Above</button>
                <button class="menu-item" onclick="loadExample('preposition-below.html', 'Below', this)">Below</button>
                <button class="menu-item" onclick="loadExample('preposition-between.html', 'Between', this)">Between</button>
                <button class="menu-item" onclick="loadExample('preposition-among.html', 'Among', this)">Among</button>
                <button class="menu-item" onclick="loadExample('preposition-beside.html', 'Beside', this)">Beside</button>
                <button class="menu-item" onclick="loadExample('preposition-behind.html', 'Behind', this)">Behind</button>
                <button class="menu-item" onclick="loadExample('preposition-beneath.html', 'Beneath', this)">Beneath</button>
                <button class="menu-item" onclick="loadExample('preposition-within.html', 'Within', this)">Within</button>
                <button class="menu-item" onclick="loadExample('preposition-through.html', 'Through', this)">Through</button>
            </div>

            <div class="menu-group">
                <div class="group-title">Movement & Direction</div>
                <button class="menu-item" onclick="loadExample('preposition-toward.html', 'Toward', this)">Toward</button>
                <button class="menu-item" onclick="loadExample('preposition-away.html', 'Away', this)">Away</button>
                <button class="menu-item" onclick="loadExample('preposition-across.html', 'Across', this)">Across</button>
                <button class="menu-item" onclick="loadExample('preposition-along.html', 'Along', this)">Along</button>
                <button class="menu-item" onclick="loadExample('preposition-around.html', 'Around', this)">Around</button>
                <button class="menu-item" onclick="loadExample('preposition-into.html', 'Into', this)">Into</button>
                <button class="menu-item" onclick="loadExample('preposition-onto.html', 'Onto', this)">Onto</button>
                <button class="menu-item" onclick="loadExample('preposition-past.html', 'Past', this)">Past</button>
                <button class="menu-item" onclick="loadExample('preposition-over.html', 'Over', this)">Over</button>
                <button class="menu-item" onclick="loadExample('preposition-under.html', 'Under', this)">Under</button>
            </div>

            <div class="menu-group">
                <div class="group-title">Time-based</div>
                <button class="menu-item" onclick="loadExample('preposition-before.html', 'Before', this)">Before</button>
                <button class="menu-item" onclick="loadExample('preposition-after.html', 'After', this)">After</button>
                <button class="menu-item" onclick="loadExample('preposition-during.html', 'During', this)">During</button>
                <button class="menu-item" onclick="loadExample('preposition-since.html', 'Since', this)">Since</button>
                <button class="menu-item" onclick="loadExample('preposition-until.html', 'Until', this)">Until</button>
            </div>
        </div>

        <div class="content">
            <div class="content-header">
                <h2 id="current-title">Welcome</h2>
            </div>
            <div class="frame-container">
                <div class="welcome-message" id="welcome-message">
                    <div class="welcome-content">
                        <h3>Welcome to P5.js Prepositions</h3>
                        <p>This collection contains interactive examples showing how spatial, directional, and temporal prepositions can be translated into P5.js sketches.</p>
                        <p>Select a preposition from the menu to explore its interactive example.</p>
                        <p><strong>24 examples total:</strong></p>
                        <p>• 9 Spatial Relationships<br>• 10 Movement & Direction<br>• 5 Time-based</p>
                    </div>
                </div>
                <iframe id="content-frame" style="display: none;" allow="popups"></iframe>
            </div>
        </div>
    </div>

    <script>
        let isMobile = window.innerWidth <= 768;
        
        // Update mobile state on resize
        window.addEventListener('resize', function() {
            isMobile = window.innerWidth <= 768;
        });
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('mobile-backdrop');
            
            console.log('toggleSidebar called, isMobile:', isMobile);
            console.log('sidebar element:', sidebar);
            
            if (isMobile) {
                const isOpen = sidebar.classList.contains('mobile-open');
                console.log('sidebar isOpen:', isOpen);
                
                if (isOpen) {
                    sidebar.classList.remove('mobile-open');
                    backdrop.classList.remove('active');
                    console.log('closing sidebar');
                } else {
                    sidebar.classList.add('mobile-open');
                    backdrop.classList.add('active');
                    console.log('opening sidebar, classes:', sidebar.classList.toString());
                    
                    // Force show menu groups on mobile
                    const menuGroups = document.querySelectorAll('.menu-group');
                    menuGroups.forEach((group, index) => {
                        group.style.display = 'block';
                        group.style.visibility = 'visible';
                        console.log('Menu group', index, 'display:', window.getComputedStyle(group).display);
                    });
                }
            } else {
                // Desktop behavior (original)
                const menuGroups = document.querySelectorAll('.menu-group');
                const isCollapsed = sidebar.classList.contains('collapsed');
                
                if (isCollapsed) {
                    sidebar.classList.remove('collapsed');
                    menuGroups.forEach(group => group.style.display = 'block');
                } else {
                    sidebar.classList.add('collapsed');
                    menuGroups.forEach(group => group.style.display = 'none');
                }
            }
        }
        
        function closeSidebar() {
            if (isMobile) {
                const sidebar = document.getElementById('sidebar');
                const backdrop = document.getElementById('mobile-backdrop');
                sidebar.classList.remove('mobile-open');
                backdrop.classList.remove('active');
            }
        }

        function loadExample(filename, title, buttonElement) {
            // Remove active class from all menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            
            // Add active class to clicked item
            buttonElement.classList.add('active');
            
            // Update title
            document.getElementById('current-title').textContent = 'Preposition: ' + title;
            
            // Hide welcome message and show iframe
            document.getElementById('welcome-message').style.display = 'none';
            const iframe = document.getElementById('content-frame');
            iframe.style.display = 'block';
            iframe.src = filename;

            // Close sidebar on mobile after selection
            closeSidebar();
        }

        // Event listeners
        document.getElementById('mobile-toggle').addEventListener('click', toggleSidebar);
        document.getElementById('mobile-backdrop').addEventListener('click', closeSidebar);

        // Add keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                if (isMobile && document.getElementById('sidebar').classList.contains('mobile-open')) {
                    closeSidebar();
                } else {
                    // Return to welcome screen
                    const menuItems = document.querySelectorAll('.menu-item');
                    menuItems.forEach(item => item.classList.remove('active'));
                    
                    document.getElementById('current-title').textContent = 'Welcome';
                    document.getElementById('welcome-message').style.display = 'flex';
                    document.getElementById('content-frame').style.display = 'none';
                }
            }
        });

        // Handle iframe load and enhance touch support
        const iframe = document.getElementById('content-frame');
        
        iframe.addEventListener('load', function() {
            try {
                // Enhance touch support for p5.js content
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Add touch-action CSS to iframe body
                if (iframeDoc && iframeDoc.body) {
                    iframeDoc.body.style.touchAction = 'auto';
                    iframeDoc.body.style.webkitOverflowScrolling = 'touch';
                    iframeDoc.body.style.overflowY = 'auto';
                    iframeDoc.body.style.height = 'auto';
                    iframeDoc.body.style.minHeight = '100vh';
                    
                    // Ensure canvas elements allow touch
                    const canvases = iframeDoc.querySelectorAll('canvas');
                    canvases.forEach(canvas => {
                        canvas.style.touchAction = 'none'; // Allow p5.js to handle touch
                    });
                    
                    // Fix Web Editor links on mobile
                    const webEditorLinks = iframeDoc.querySelectorAll('.web-editor-link');
                    webEditorLinks.forEach(link => {
                        link.addEventListener('click', function(e) {
                            if (isMobile) {
                                e.preventDefault();
                                // Open in parent window instead of popup on mobile
                                window.open(link.href, '_blank');
                            }
                        });
                    });
                    
                    // Ensure proper scrolling for iframe content
                    if (isMobile) {
                        iframeDoc.documentElement.style.height = 'auto';
                        iframeDoc.documentElement.style.overflowY = 'auto';
                        
                        // Add mobile-specific styles to iframe content
                        const style = iframeDoc.createElement('style');
                        style.textContent = `
                            @media (max-width: 768px) {
                                body {
                                    height: auto !important;
                                    min-height: 100vh !important;
                                    overflow-y: auto !important;
                                    -webkit-overflow-scrolling: touch !important;
                                }
                                .description {
                                    margin: 10px !important;
                                    padding: 15px !important;
                                }
                                .container {
                                    min-height: auto !important;
                                    flex-direction: column !important;
                                }
                            }
                        `;
                        iframeDoc.head.appendChild(style);
                    }
                }
            } catch (e) {
                // Cross-origin restrictions may prevent access
                console.log('Cross-origin restrictions prevent iframe enhancement');
            }
        });

        iframe.addEventListener('error', function() {
            alert('Error loading the example. Please check if the file exists.');
        });

        // Prevent zoom on double-tap for better mobile UX
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
