<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>P5.js Preposition Examples</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Enhanced mobile iframe fixes */
        @media (max-width: 768px) {
            .frame-container {
                height: 75vh !important;
                min-height: 500px !important;
                overflow: auto !important;
                -webkit-overflow-scrolling: touch !important;
                border: 1px solid #ddd;
            }
            
            iframe {
                width: 100% !important;
                height: 100% !important;
                border: none !important;
                display: block !important;
            }
            
            /* Ensure iframe content is properly sized */
            .content {
                flex: 1 !important;
                min-height: 75vh !important;
            }
            
            /* Fix for web editor buttons inside iframe */
            .index-body {
                overflow: visible !important;
                height: auto !important;
            }
        }
        
        @media (max-width: 480px) {
            .frame-container {
                height: 70vh !important;
                min-height: 450px !important;
            }
            
            .content {
                min-height: 70vh !important;
            }
        }
    </style>
</head>
<body class="index-body">
    <div class="index-container">
        <div class="sidebar">
            <div class="header">
                <h1>P5.js Prepositions</h1>
                <p>Methods for converting language to code</p>
                <button class="mobile-toggle" id="mobile-toggle" onclick="toggleSidebar()">☰ Menu</button>
            </div>

            <div class="menu-group">
                <div class="group-title">Spatial Relationships</div>
                <button class="menu-item" onclick="loadExample('preposition-above.html', 'Above', this)">Above</button>
                <button class="menu-item" onclick="loadExample('preposition-below.html', 'Below', this)">Below</button>
                <button class="menu-item" onclick="loadExample('preposition-between.html', 'Between', this)">Between</button>
                <button class="menu-item" onclick="loadExample('preposition-among.html', 'Among', this)">Among</button>
                <button class="menu-item" onclick="loadExample('preposition-beside.html', 'Beside', this)">Beside</button>
                <button class="menu-item" onclick="loadExample('preposition-behind.html', 'Behind', this)">Behind</button>
                <button class="menu-item" onclick="loadExample('preposition-beneath.html', 'Beneath', this)">Beneath</button>
                <button class="menu-item" onclick="loadExample('preposition-within.html', 'Within', this)">Within</button>
                <button class="menu-item" onclick="loadExample('preposition-through.html', 'Through', this)">Through</button>
            </div>
            
            <div class="menu-group">
                <div class="group-title">Movement & Direction</div>
                <button class="menu-item" onclick="loadExample('preposition-toward.html', 'Toward', this)">Toward</button>
                <button class="menu-item" onclick="loadExample('preposition-away.html', 'Away', this)">Away</button>
                <button class="menu-item" onclick="loadExample('preposition-across.html', 'Across', this)">Across</button>
                <button class="menu-item" onclick="loadExample('preposition-along.html', 'Along', this)">Along</button>
                <button class="menu-item" onclick="loadExample('preposition-around.html', 'Around', this)">Around</button>
                <button class="menu-item" onclick="loadExample('preposition-into.html', 'Into', this)">Into</button>
                <button class="menu-item" onclick="loadExample('preposition-onto.html', 'Onto', this)">Onto</button>
                <button class="menu-item" onclick="loadExample('preposition-past.html', 'Past', this)">Past</button>
                <button class="menu-item" onclick="loadExample('preposition-over.html', 'Over', this)">Over</button>
                <button class="menu-item" onclick="loadExample('preposition-under.html', 'Under', this)">Under</button>
            </div>

            <div class="menu-group">
                <div class="group-title">Time-based</div>
                <button class="menu-item" onclick="loadExample('preposition-before.html', 'Before', this)">Before</button>
                <button class="menu-item" onclick="loadExample('preposition-after.html', 'After', this)">After</button>
                <button class="menu-item" onclick="loadExample('preposition-during.html', 'During', this)">During</button>
                <button class="menu-item" onclick="loadExample('preposition-since.html', 'Since', this)">Since</button>
                <button class="menu-item" onclick="loadExample('preposition-until.html', 'Until', this)">Until</button>
            </div>
        </div>

        <div class="content">
            <div class="content-header">
                <h2 id="current-title">Welcome</h2>
                <button id="back-button" onclick="goBack()" style="display: none; float: right; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;">← Back</button>
            </div>
            <div class="frame-container">
                <div class="welcome-message" id="welcome-message">
                    <div class="welcome-content">
                        <h3>Welcome to P5.js Prepositions</h3>
                        <p>This collection contains interactive examples showing how spatial, directional, and temporal prepositions can be translated into P5.js sketches.</p>
                        <p>Select a preposition from the menu to explore its interactive example.</p>
                        <p><strong>24 examples total:</strong></p>
                        <p>• 9 Spatial Relationships<br>• 10 Movement & Direction<br>• 5 Time-based</p>
                    </div>
                </div>
                <iframe id="content-frame" style="display: none;" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox"></iframe>
            </div>
        </div>
    </div>

    <script>
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const menuGroups = document.querySelectorAll('.menu-group');
            const isCollapsed = sidebar.classList.contains('collapsed');
            
            if (isCollapsed) {
                sidebar.classList.remove('collapsed');
                menuGroups.forEach(group => group.style.display = 'block');
            } else {
                sidebar.classList.add('collapsed');
                menuGroups.forEach(group => group.style.display = 'none');
            }
        }

        function loadExample(filename, title, buttonElement) {
            // Remove active class from all menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            
            // Add active class to clicked item
            buttonElement.classList.add('active');
            
            // Update title
            document.getElementById('current-title').textContent = 'Preposition: ' + title;
            
            // Show back button
            document.getElementById('back-button').style.display = 'inline-block';
            
            // Hide welcome message and show iframe
            document.getElementById('welcome-message').style.display = 'none';
            const iframe = document.getElementById('content-frame');
            iframe.style.display = 'block';
            
            // Add cache-busting parameter and ensure proper loading
            const cacheBuster = '?v=' + Date.now();
            iframe.src = filename + cacheBuster;
            
            // Enhanced iframe loading with error handling
            iframe.onload = function() {
                console.log('Iframe loaded successfully: ' + filename);
                
                // Try to enable scrolling in iframe content (if same-origin)
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    if (iframeDoc) {
                        iframeDoc.body.style.overflow = 'auto';
                        iframeDoc.documentElement.style.overflow = 'auto';
                    }
                } catch(e) {
                    console.log('Cross-origin iframe - cannot modify content directly');
                }
            };
            
            iframe.onerror = function() {
                console.error('Failed to load iframe: ' + filename);
                alert('Error loading example: ' + filename);
            };

            // On mobile, auto-collapse sidebar after selection
            if (window.innerWidth <= 768) {
                const sidebar = document.querySelector('.sidebar');
                const menuGroups = document.querySelectorAll('.menu-group');
                sidebar.classList.add('collapsed');
                menuGroups.forEach(group => group.style.display = 'none');
            }
        }

        function goBack() {
            // Remove active class from all menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            
            // Hide back button
            document.getElementById('back-button').style.display = 'none';
            
            // Return to welcome screen
            document.getElementById('current-title').textContent = 'Welcome';
            document.getElementById('welcome-message').style.display = 'flex';
            document.getElementById('content-frame').style.display = 'none';
            document.getElementById('content-frame').src = ''; // Clear iframe
        }

        // Add keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                goBack();
            }
        });

        // Handle iframe load errors with retry mechanism
        document.getElementById('content-frame').addEventListener('error', function() {
            console.error('Iframe load error detected');
            setTimeout(() => {
                alert('Error loading the example. Please check your internet connection and try again.');
            }, 100);
        });

        // Enhanced mobile viewport handling
        function handleViewportChange() {
            if (window.innerWidth <= 768) {
                // Force iframe to refresh its dimensions on mobile
                const iframe = document.getElementById('content-frame');
                if (iframe.style.display !== 'none') {
                    const currentSrc = iframe.src;
                    iframe.src = '';
                    setTimeout(() => {
                        iframe.src = currentSrc;
                    }, 50);
                }
            }
        }

        // Listen for orientation changes on mobile
        window.addEventListener('orientationchange', handleViewportChange);
        window.addEventListener('resize', handleViewportChange);

        // Debug logging for mobile testing
        console.log('Index3.html loaded - Mobile Debug Mode');
        console.log('Viewport: ' + window.innerWidth + 'x' + window.innerHeight);
        console.log('User Agent: ' + navigator.userAgent);
    </script>
</body>
</html>
